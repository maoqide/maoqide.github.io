<!DOCTYPE html>
<html lang="en">

<head>
  <title>
  Upgrade Kubeadm Cluster · maoqide
</title>
  <meta charset="utf-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<meta name="color-scheme" content="light dark">




<meta name="author" content="Maoqide">
<meta name="description" content="升级 kubeadm 部署的 kubernetes 集群。">
<meta name="keywords" content="blog,developer,cloud-native">

<meta name="twitter:card" content="summary"/><meta name="twitter:title" content="Upgrade Kubeadm Cluster"/>
<meta name="twitter:description" content="升级 kubeadm 部署的 kubernetes 集群。"/>

<meta property="og:title" content="Upgrade Kubeadm Cluster" />
<meta property="og:description" content="升级 kubeadm 部署的 kubernetes 集群。" />
<meta property="og:type" content="article" />
<meta property="og:url" content="/posts/notes/upgrade-kubeadm-cluster/" /><meta property="article:section" content="posts" />
<meta property="article:published_time" content="2019-10-31T09:50:41+08:00" />
<meta property="article:modified_time" content="2019-10-31T09:50:41+08:00" />





<link rel="canonical" href="/posts/notes/upgrade-kubeadm-cluster/">


<link rel="preload" href="/fonts/fa-brands-400.woff2" as="font" type="font/woff2" crossorigin>
<link rel="preload" href="/fonts/fa-regular-400.woff2" as="font" type="font/woff2" crossorigin>
<link rel="preload" href="/fonts/fa-solid-900.woff2" as="font" type="font/woff2" crossorigin>


  
  
  <link rel="stylesheet" href="/css/coder.min.577e3c5ead537873430da16f0964b754a120fd87c4e2203a00686e7c75b51378.css" integrity="sha256-V348Xq1TeHNDDaFvCWS3VKEg/YfE4iA6AGhufHW1E3g=" crossorigin="anonymous" media="screen" />






  
    
    
    <link rel="stylesheet" href="/css/coder-dark.min.a00e6364bacbc8266ad1cc81230774a1397198f8cfb7bcba29b7d6fcb54ce57f.css" integrity="sha256-oA5jZLrLyCZq0cyBIwd0oTlxmPjPt7y6KbfW/LVM5X8=" crossorigin="anonymous" media="screen" />
  



 




<link rel="icon" type="image/svg+xml" href="/img/favicon.svg" sizes="any">
<link rel="icon" type="image/png" href="/img/favicon-32x32.png" sizes="32x32">
<link rel="icon" type="image/png" href="/img/favicon-16x16.png" sizes="16x16">

<link rel="apple-touch-icon" href="/images/apple-touch-icon.png">
<link rel="apple-touch-icon" sizes="180x180" href="/images/apple-touch-icon.png">

<link rel="manifest" href="/site.webmanifest">
<link rel="mask-icon" href="/images/safari-pinned-tab.svg" color="#5bbad5">









</head>






<body class="preload-transitions colorscheme-auto">
  
<div class="float-container">
    <a id="dark-mode-toggle" class="colorscheme-toggle">
        <i class="fa-solid fa-adjust fa-fw" aria-hidden="true"></i>
    </a>
</div>


  <main class="wrapper">
    <nav class="navigation">
  <section class="container">
    <a class="navigation-title" href="/">
      maoqide
    </a>
    
      <input type="checkbox" id="menu-toggle" />
      <label class="menu-button float-right" for="menu-toggle">
        <i class="fa-solid fa-bars fa-fw" aria-hidden="true"></i>
      </label>
      <ul class="navigation-list">
        
          
            <li class="navigation-item">
              <a class="navigation-link " href="/posts/">Blog</a>
            </li>
          
            <li class="navigation-item">
              <a class="navigation-link " href="/tags/">Tag</a>
            </li>
          
            <li class="navigation-item">
              <a class="navigation-link " href="/about/">About</a>
            </li>
          
        
        
      </ul>
    
  </section>
</nav>


    <div class="content">
      
  <section class="container post">
    <article>
      <header>
        <div class="post-title">
          <h1 class="title">
            <a class="title-link" href="/posts/notes/upgrade-kubeadm-cluster/">
              Upgrade Kubeadm Cluster
            </a>
          </h1>
        </div>
        <div class="post-meta">
          <div class="date">
            <span class="posted-on">
              <i class="fa-solid fa-calendar" aria-hidden="true"></i>
              <time datetime="2019-10-31T09:50:41&#43;08:00">
                October 31, 2019
              </time>
            </span>
            <span class="reading-time">
              <i class="fa-solid fa-clock" aria-hidden="true"></i>
              9-minute read
            </span>
          </div>
          
          
          <div class="tags">
  <i class="fa-solid fa-tag" aria-hidden="true"></i>
    <span class="tag">
      <a href="/tags/kubernetes/">kubernetes</a>
    </span>
      <span class="separator">•</span>
    <span class="tag">
      <a href="/tags/kubeadm/">kubeadm</a>
    </span>
      <span class="separator">•</span>
    <span class="tag">
      <a href="/tags/upgrade/">upgrade</a>
    </span></div>

        </div>
      </header>

      <div class="post-content">
        
        <p>升级 kubeadm 部署的 kubernetes 集群。</p>
<h2 id="当前环境">
  当前环境
  <a class="heading-link" href="#%e5%bd%93%e5%89%8d%e7%8e%af%e5%a2%83">
    <i class="fa-solid fa-link" aria-hidden="true" title="Link to heading"></i>
    <span class="sr-only">Link to heading</span>
  </a>
</h2>
<div class="highlight"><pre tabindex="0" style="color:#e6edf3;background-color:#0d1117;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-shell" data-lang="shell"><span style="display:flex;"><span><span style="color:#ff7b72;font-weight:bold">[</span>root@centos10 ~<span style="color:#ff7b72;font-weight:bold">]</span>$ uname -a 
</span></span><span style="display:flex;"><span>Linux centos10 3.10.0-957.27.2.el7.x86_64 <span style="color:#8b949e;font-style:italic">#1 SMP Mon Jul 29 17:46:05 UTC 2019 x86_64 x86_64 x86_64 GNU/Linux</span>
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span><span style="color:#ff7b72;font-weight:bold">[</span>root@centos10 ~<span style="color:#ff7b72;font-weight:bold">]</span>$ kubectl version
</span></span><span style="display:flex;"><span>Client Version: version.Info<span style="color:#ff7b72;font-weight:bold">{</span>Major:<span style="color:#a5d6ff">&#34;1&#34;</span>, Minor:<span style="color:#a5d6ff">&#34;11&#34;</span>, GitVersion:<span style="color:#a5d6ff">&#34;v1.11.10&#34;</span>, GitCommit:<span style="color:#a5d6ff">&#34;7a578febe155a7366767abce40d8a16795a96371&#34;</span>, GitTreeState:<span style="color:#a5d6ff">&#34;clean&#34;</span>, BuildDate:<span style="color:#a5d6ff">&#34;2019-05-01T04:14:38Z&#34;</span>, GoVersion:<span style="color:#a5d6ff">&#34;go1.10.8&#34;</span>, Compiler:<span style="color:#a5d6ff">&#34;gc&#34;</span>, Platform:<span style="color:#a5d6ff">&#34;linux/amd64&#34;</span><span style="color:#ff7b72;font-weight:bold">}</span>
</span></span><span style="display:flex;"><span>Server Version: version.Info<span style="color:#ff7b72;font-weight:bold">{</span>Major:<span style="color:#a5d6ff">&#34;1&#34;</span>, Minor:<span style="color:#a5d6ff">&#34;11&#34;</span>, GitVersion:<span style="color:#a5d6ff">&#34;v1.11.10&#34;</span>, GitCommit:<span style="color:#a5d6ff">&#34;7a578febe155a7366767abce40d8a16795a96371&#34;</span>, GitTreeState:<span style="color:#a5d6ff">&#34;clean&#34;</span>, BuildDate:<span style="color:#a5d6ff">&#34;2019-05-01T04:05:01Z&#34;</span>, GoVersion:<span style="color:#a5d6ff">&#34;go1.10.8&#34;</span>, Compiler:<span style="color:#a5d6ff">&#34;gc&#34;</span>, Platform:<span style="color:#a5d6ff">&#34;linux/amd64&#34;</span><span style="color:#ff7b72;font-weight:bold">}</span>
</span></span></code></pre></div><h2 id="确认升级版本">
  确认升级版本
  <a class="heading-link" href="#%e7%a1%ae%e8%ae%a4%e5%8d%87%e7%ba%a7%e7%89%88%e6%9c%ac">
    <i class="fa-solid fa-link" aria-hidden="true" title="Link to heading"></i>
    <span class="sr-only">Link to heading</span>
  </a>
</h2>
<p>由于目前集群版本和最新版本相差版本较多，采用逐个版本升级的策略，首先确认要升级到的具体版本。</p>
<div class="highlight"><pre tabindex="0" style="color:#e6edf3;background-color:#0d1117;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-shell" data-lang="shell"><span style="display:flex;"><span>yum list --showduplicates | grep kubeadm
</span></span></code></pre></div><p>选取要升级版本的最新小版本，即<code>1.12.10-0</code>。</p>
<h2 id="升级-master">
  升级 master
  <a class="heading-link" href="#%e5%8d%87%e7%ba%a7-master">
    <i class="fa-solid fa-link" aria-hidden="true" title="Link to heading"></i>
    <span class="sr-only">Link to heading</span>
  </a>
</h2>
<div class="highlight"><pre tabindex="0" style="color:#e6edf3;background-color:#0d1117;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-shell" data-lang="shell"><span style="display:flex;"><span><span style="color:#8b949e;font-style:italic"># backup config</span>
</span></span><span style="display:flex;"><span>kubeadm config view &gt; kubeadm.yaml
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span><span style="color:#8b949e;font-style:italic"># upgrade kubeadm</span>
</span></span><span style="display:flex;"><span>yum upgrade -y kubeadm-1.12.x --disableexcludes<span style="color:#ff7b72;font-weight:bold">=</span>kubernetes
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span><span style="color:#8b949e;font-style:italic"># confirm version</span>
</span></span><span style="display:flex;"><span>kubeadm version
</span></span></code></pre></div><p><code>kubeadm upgrade plan</code>查看升级组件后版本</p>
<div class="highlight"><pre tabindex="0" style="color:#e6edf3;background-color:#0d1117;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-shell" data-lang="shell"><span style="display:flex;"><span><span style="color:#ff7b72;font-weight:bold">[</span>root@centos10 v1.12.10<span style="color:#ff7b72;font-weight:bold">]</span><span style="color:#8b949e;font-style:italic"># kubeadm upgrade plan</span>
</span></span><span style="display:flex;"><span><span style="color:#ff7b72;font-weight:bold">[</span>preflight<span style="color:#ff7b72;font-weight:bold">]</span> Running pre-flight checks.
</span></span><span style="display:flex;"><span><span style="color:#ff7b72;font-weight:bold">[</span>upgrade<span style="color:#ff7b72;font-weight:bold">]</span> Making sure the cluster is healthy:
</span></span><span style="display:flex;"><span><span style="color:#ff7b72;font-weight:bold">[</span>upgrade/config<span style="color:#ff7b72;font-weight:bold">]</span> Making sure the configuration is correct:
</span></span><span style="display:flex;"><span><span style="color:#ff7b72;font-weight:bold">[</span>upgrade/config<span style="color:#ff7b72;font-weight:bold">]</span> Reading configuration from the cluster...
</span></span><span style="display:flex;"><span><span style="color:#ff7b72;font-weight:bold">[</span>upgrade/config<span style="color:#ff7b72;font-weight:bold">]</span> FYI: You can look at this config file with <span style="color:#a5d6ff">&#39;kubectl -n kube-system get cm kubeadm-config -oyaml&#39;</span>
</span></span><span style="display:flex;"><span><span style="color:#ff7b72;font-weight:bold">[</span>upgrade<span style="color:#ff7b72;font-weight:bold">]</span> Fetching available versions to upgrade to
</span></span><span style="display:flex;"><span><span style="color:#ff7b72;font-weight:bold">[</span>upgrade/versions<span style="color:#ff7b72;font-weight:bold">]</span> Cluster version: v1.11.10
</span></span><span style="display:flex;"><span><span style="color:#ff7b72;font-weight:bold">[</span>upgrade/versions<span style="color:#ff7b72;font-weight:bold">]</span> kubeadm version: v1.12.10
</span></span><span style="display:flex;"><span>I1031 13:42:09.427100    <span style="color:#a5d6ff">7721</span> version.go:93<span style="color:#ff7b72;font-weight:bold">]</span> could not fetch a Kubernetes version from the internet: unable to get URL <span style="color:#a5d6ff">&#34;https://dl.k8s.io/release/stable.txt&#34;</span>: Get https://dl.k8s.io/release/stable.txt: net/http: request canceled <span style="color:#ff7b72">while</span> waiting <span style="color:#ff7b72">for</span> connection <span style="color:#ff7b72;font-weight:bold">(</span>Client.Timeout exceeded <span style="color:#ff7b72">while</span> awaiting headers<span style="color:#ff7b72;font-weight:bold">)</span>
</span></span><span style="display:flex;"><span>I1031 13:42:09.427154    <span style="color:#a5d6ff">7721</span> version.go:94<span style="color:#ff7b72;font-weight:bold">]</span> falling back to the local client version: v1.12.10
</span></span><span style="display:flex;"><span><span style="color:#ff7b72;font-weight:bold">[</span>upgrade/versions<span style="color:#ff7b72;font-weight:bold">]</span> Latest stable version: v1.12.10
</span></span><span style="display:flex;"><span>I1031 13:42:19.466181    <span style="color:#a5d6ff">7721</span> version.go:93<span style="color:#ff7b72;font-weight:bold">]</span> could not fetch a Kubernetes version from the internet: unable to get URL <span style="color:#a5d6ff">&#34;https://dl.k8s.io/release/stable-1.11.txt&#34;</span>: Get https://dl.k8s.io/release/stable-1.11.txt: net/http: request canceled <span style="color:#ff7b72">while</span> waiting <span style="color:#ff7b72">for</span> connection <span style="color:#ff7b72;font-weight:bold">(</span>Client.Timeout exceeded <span style="color:#ff7b72">while</span> awaiting headers<span style="color:#ff7b72;font-weight:bold">)</span>
</span></span><span style="display:flex;"><span>I1031 13:42:19.466211    <span style="color:#a5d6ff">7721</span> version.go:94<span style="color:#ff7b72;font-weight:bold">]</span> falling back to the local client version: v1.12.10
</span></span><span style="display:flex;"><span><span style="color:#ff7b72;font-weight:bold">[</span>upgrade/versions<span style="color:#ff7b72;font-weight:bold">]</span> Latest version in the v1.11 series: v1.12.10
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>External components that should be upgraded manually before you upgrade the control plane with <span style="color:#a5d6ff">&#39;kubeadm upgrade apply&#39;</span>:
</span></span><span style="display:flex;"><span>COMPONENT   CURRENT   AVAILABLE
</span></span><span style="display:flex;"><span>Etcd        3.3.13    3.2.24
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>Components that must be upgraded manually after you have upgraded the control plane with <span style="color:#a5d6ff">&#39;kubeadm upgrade apply&#39;</span>:
</span></span><span style="display:flex;"><span>COMPONENT   CURRENT        AVAILABLE
</span></span><span style="display:flex;"><span>Kubelet     <span style="color:#a5d6ff">3</span> x v1.11.10   v1.12.10
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>Upgrade to the latest version in the v1.11 series:
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>COMPONENT            CURRENT    AVAILABLE
</span></span><span style="display:flex;"><span>API Server           v1.11.10   v1.12.10
</span></span><span style="display:flex;"><span>Controller Manager   v1.11.10   v1.12.10
</span></span><span style="display:flex;"><span>Scheduler            v1.11.10   v1.12.10
</span></span><span style="display:flex;"><span>Kube Proxy           v1.11.10   v1.12.10
</span></span><span style="display:flex;"><span>CoreDNS              1.1.3      1.2.2
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>You can now apply the upgrade by executing the following command:
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>   kubeadm upgrade apply v1.12.10
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>_____________________________________________________________________
</span></span></code></pre></div><p>可以看到升级后 k8s 各组件版本，由于无法直接访问 gcr 镜像仓库，需要手动拉取对应版本。 <br>
k8s组件的镜像命名基本为 <code>k8s.gcr.io/&lt;component-name&gt;-&lt;arch&gt;:&lt;component-version&gt;</code> 或 <code>gcr.io/google-containers/&lt;component-name&gt;:&lt;component-version&gt;</code>, 二者实际上是同一仓库，国内可以使用azure 的镜像仓库下载，只要将后者<code>gcr.io</code>替换为<code>gcr.azk8s.cn</code>即可。也可以使用<code>https://raw.githubusercontent.com/maoqide/utils/master/pullgcr.sh</code>脚本一键拉取。</p>
<div class="highlight"><pre tabindex="0" style="color:#e6edf3;background-color:#0d1117;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-shell" data-lang="shell"><span style="display:flex;"><span>pullgcr k8s.gcr.io/kube-apiserver:v1.12.10
</span></span><span style="display:flex;"><span>pullgcr k8s.gcr.io/kube-controller-manager:v1.12.10
</span></span><span style="display:flex;"><span>pullgcr k8s.gcr.io/kube-scheduler:v1.12.10
</span></span><span style="display:flex;"><span>pullgcr k8s.gcr.io/kube-proxy:v1.12.10
</span></span><span style="display:flex;"><span>pullgcr k8s.gcr.io/coredns:1.2.2
</span></span><span style="display:flex;"><span>pullgcr k8s.gcr.io/etcd:3.2.24
</span></span></code></pre></div><p>如果使用的内部镜像仓库，将以上镜像tag后推送到内部的镜像仓库中。</p>
<div class="highlight"><pre tabindex="0" style="color:#e6edf3;background-color:#0d1117;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-shell" data-lang="shell"><span style="display:flex;"><span><span style="color:#8b949e;font-style:italic"># using dry-run flag for validation</span>
</span></span><span style="display:flex;"><span>kubeadm upgrade apply v1.12.10 --config kubeadm.yaml --dry-run
</span></span></code></pre></div><p>使用 <code>kubeadm config view</code> 保存的配置，有可能有遗漏，在升级时遇到主节点的 nodeName 配置没有保存，所以在更新时，使用默认的 hostname 为 node name，导致在拉起apiserver的静态pod时，以 kube-apiserver-&lt;node-name&gt;的规则拼接 pod 名出错，一直找不到已有的 apiserver 的静态pod，进而导致 upgrade 超时而失败。  <br>
遇到<code>kubeadm upgrade</code>一直卡住并最终超时的情况时，首先 <code>kubeadm upgrade apply  v1.12.10 --config kubeadm.yaml  -v 5</code>的时候添加 <code>-v</code>参数指定 log 等级，一般到5就比较详细了，然后通过日志来定位问题，以上问题就是通过如下日志看到一直在请求错误的 apiserver 的pod名称，从而定位到错误。</p>
<pre tabindex="0"><code>[upgrade/apply] Upgrading your Static Pod-hosted control plane to version &#34;v1.12.10&#34;...
I1031 16:03:08.955081   25594 request.go:530] Throttling request took 185.13957ms, request: GET:https://172.27.32.165:6443/api/v1/namespaces/kube-system/pods/kube-apiserver-centos10
</code></pre><p>解决：<code>kubeadm config print-default</code> 可以查看 kubeadm 的 config 文件的所有默认的配置，查看后发现有如下<code>nodeRegistration</code>配置, 将node name默认指定成主机的 hostname，导致了上述的错误，在之前通过<code>kubeadm config view</code>生成的配置文件中，加上</p>
<pre tabindex="0"><code>nodeRegistration:
  name: &lt;real-node-name&gt;
</code></pre><p>并重新执行<code>kubeadm upgrade apply  v1.12.10 --config kubeadm.yaml</code>即可。</p>
<p>在1.13及以后版本中，<code>kubeadm config print-default</code> 被修改为<code>kubeadm config print</code>的子命令，可执行<code>kubeadm config print init-defaults</code>。</p>
<pre tabindex="0"><code>...

nodeRegistration:
  criSocket: /var/run/dockershim.sock
  name: centos10
tlsBootstrapToken: abcdef.0123456789abcdef
token: abcdef.0123456789abcdef
...
</code></pre><pre><code>1.12升1.13及以后版本，不需要指定 --condig 参数，kubeadm会自动从configmap中读取，只需要执行 kubeadm upgrade apply v1.13.12 即可。     
</code></pre>
<div class="highlight"><pre tabindex="0" style="color:#e6edf3;background-color:#0d1117;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-shell" data-lang="shell"><span style="display:flex;"><span><span style="color:#ff7b72;font-weight:bold">[</span>root@centos10 v1.12.10<span style="color:#ff7b72;font-weight:bold">]</span>$ kubeadm upgrade apply  v1.12.10 --config kubeadm.yaml  -v <span style="color:#a5d6ff">5</span>
</span></span><span style="display:flex;"><span>I1031 16:18:09.848434   <span style="color:#a5d6ff">31033</span> apply.go:86<span style="color:#ff7b72;font-weight:bold">]</span> running preflight checks
</span></span><span style="display:flex;"><span><span style="color:#ff7b72;font-weight:bold">[</span>preflight<span style="color:#ff7b72;font-weight:bold">]</span> Running pre-flight checks.
</span></span><span style="display:flex;"><span>I1031 16:18:09.848496   <span style="color:#a5d6ff">31033</span> apply.go:92<span style="color:#ff7b72;font-weight:bold">]</span> fetching configuration from file kubeadm.yaml
</span></span><span style="display:flex;"><span>I1031 16:18:09.848507   <span style="color:#a5d6ff">31033</span> masterconfig.go:167<span style="color:#ff7b72;font-weight:bold">]</span> loading configuration from the given file
</span></span><span style="display:flex;"><span>I1031 16:18:09.855269   <span style="color:#a5d6ff">31033</span> feature_gate.go:206<span style="color:#ff7b72;font-weight:bold">]</span> feature gates: &amp;<span style="color:#ff7b72;font-weight:bold">{</span>map<span style="color:#ff7b72;font-weight:bold">[]}</span>
</span></span><span style="display:flex;"><span>I1031 16:18:09.855302   <span style="color:#a5d6ff">31033</span> apply.go:150<span style="color:#ff7b72;font-weight:bold">]</span> <span style="color:#ff7b72;font-weight:bold">[</span>upgrade/apply<span style="color:#ff7b72;font-weight:bold">]</span> verifying health of cluster
</span></span><span style="display:flex;"><span>I1031 16:18:09.855307   <span style="color:#a5d6ff">31033</span> apply.go:151<span style="color:#ff7b72;font-weight:bold">]</span> <span style="color:#ff7b72;font-weight:bold">[</span>upgrade/apply<span style="color:#ff7b72;font-weight:bold">]</span> retrieving configuration from cluster
</span></span><span style="display:flex;"><span><span style="color:#ff7b72;font-weight:bold">[</span>upgrade<span style="color:#ff7b72;font-weight:bold">]</span> Making sure the cluster is healthy:
</span></span><span style="display:flex;"><span><span style="color:#ff7b72;font-weight:bold">[</span>upgrade/config<span style="color:#ff7b72;font-weight:bold">]</span> Making sure the configuration is correct:
</span></span><span style="display:flex;"><span><span style="color:#ff7b72;font-weight:bold">[</span>upgrade/config<span style="color:#ff7b72;font-weight:bold">]</span> Reading configuration options from a file: kubeadm.yaml
</span></span><span style="display:flex;"><span><span style="color:#ff7b72;font-weight:bold">[</span>upgrade/apply<span style="color:#ff7b72;font-weight:bold">]</span> Respecting the --cri-socket flag that is set with higher priority than the config file.
</span></span><span style="display:flex;"><span>I1031 16:18:09.877158   <span style="color:#a5d6ff">31033</span> apply.go:163<span style="color:#ff7b72;font-weight:bold">]</span> <span style="color:#ff7b72;font-weight:bold">[</span>upgrade/apply<span style="color:#ff7b72;font-weight:bold">]</span> validating requested and actual version
</span></span><span style="display:flex;"><span>I1031 16:18:09.877171   <span style="color:#a5d6ff">31033</span> apply.go:181<span style="color:#ff7b72;font-weight:bold">]</span> <span style="color:#ff7b72;font-weight:bold">[</span>upgrade/version<span style="color:#ff7b72;font-weight:bold">]</span> enforcing version skew policies
</span></span><span style="display:flex;"><span><span style="color:#ff7b72;font-weight:bold">[</span>upgrade/version<span style="color:#ff7b72;font-weight:bold">]</span> You have chosen to change the cluster version to <span style="color:#a5d6ff">&#34;v1.12.10&#34;</span>
</span></span><span style="display:flex;"><span><span style="color:#ff7b72;font-weight:bold">[</span>upgrade/versions<span style="color:#ff7b72;font-weight:bold">]</span> Cluster version: v1.11.10
</span></span><span style="display:flex;"><span><span style="color:#ff7b72;font-weight:bold">[</span>upgrade/versions<span style="color:#ff7b72;font-weight:bold">]</span> kubeadm version: v1.12.10
</span></span><span style="display:flex;"><span><span style="color:#ff7b72;font-weight:bold">[</span>upgrade/confirm<span style="color:#ff7b72;font-weight:bold">]</span> Are you sure you want to proceed with the upgrade? <span style="color:#ff7b72;font-weight:bold">[</span>y/N<span style="color:#ff7b72;font-weight:bold">]</span>: y
</span></span><span style="display:flex;"><span>I1031 16:18:11.377401   <span style="color:#a5d6ff">31033</span> apply.go:195<span style="color:#ff7b72;font-weight:bold">]</span> <span style="color:#ff7b72;font-weight:bold">[</span>upgrade/apply<span style="color:#ff7b72;font-weight:bold">]</span> creating prepuller
</span></span><span style="display:flex;"><span><span style="color:#ff7b72;font-weight:bold">[</span>upgrade/prepull<span style="color:#ff7b72;font-weight:bold">]</span> Will prepull images <span style="color:#ff7b72">for</span> components <span style="color:#ff7b72;font-weight:bold">[</span>kube-apiserver kube-controller-manager kube-scheduler etcd<span style="color:#ff7b72;font-weight:bold">]</span>
</span></span><span style="display:flex;"><span><span style="color:#ff7b72;font-weight:bold">[</span>upgrade/prepull<span style="color:#ff7b72;font-weight:bold">]</span> Prepulling image <span style="color:#ff7b72">for</span> component etcd.
</span></span><span style="display:flex;"><span><span style="color:#ff7b72;font-weight:bold">[</span>upgrade/prepull<span style="color:#ff7b72;font-weight:bold">]</span> Prepulling image <span style="color:#ff7b72">for</span> component kube-apiserver.
</span></span><span style="display:flex;"><span><span style="color:#ff7b72;font-weight:bold">[</span>upgrade/prepull<span style="color:#ff7b72;font-weight:bold">]</span> Prepulling image <span style="color:#ff7b72">for</span> component kube-controller-manager.
</span></span><span style="display:flex;"><span><span style="color:#ff7b72;font-weight:bold">[</span>upgrade/prepull<span style="color:#ff7b72;font-weight:bold">]</span> Prepulling image <span style="color:#ff7b72">for</span> component kube-scheduler.
</span></span><span style="display:flex;"><span><span style="color:#ff7b72;font-weight:bold">[</span>apiclient<span style="color:#ff7b72;font-weight:bold">]</span> Found <span style="color:#a5d6ff">1</span> Pods <span style="color:#ff7b72">for</span> label selector k8s-app<span style="color:#ff7b72;font-weight:bold">=</span>upgrade-prepull-kube-apiserver
</span></span><span style="display:flex;"><span><span style="color:#ff7b72;font-weight:bold">[</span>apiclient<span style="color:#ff7b72;font-weight:bold">]</span> Found <span style="color:#a5d6ff">0</span> Pods <span style="color:#ff7b72">for</span> label selector k8s-app<span style="color:#ff7b72;font-weight:bold">=</span>upgrade-prepull-etcd
</span></span><span style="display:flex;"><span><span style="color:#ff7b72;font-weight:bold">[</span>apiclient<span style="color:#ff7b72;font-weight:bold">]</span> Found <span style="color:#a5d6ff">0</span> Pods <span style="color:#ff7b72">for</span> label selector k8s-app<span style="color:#ff7b72;font-weight:bold">=</span>upgrade-prepull-kube-scheduler
</span></span><span style="display:flex;"><span><span style="color:#ff7b72;font-weight:bold">[</span>apiclient<span style="color:#ff7b72;font-weight:bold">]</span> Found <span style="color:#a5d6ff">1</span> Pods <span style="color:#ff7b72">for</span> label selector k8s-app<span style="color:#ff7b72;font-weight:bold">=</span>upgrade-prepull-kube-controller-manager
</span></span><span style="display:flex;"><span><span style="color:#ff7b72;font-weight:bold">[</span>apiclient<span style="color:#ff7b72;font-weight:bold">]</span> Found <span style="color:#a5d6ff">1</span> Pods <span style="color:#ff7b72">for</span> label selector k8s-app<span style="color:#ff7b72;font-weight:bold">=</span>upgrade-prepull-etcd
</span></span><span style="display:flex;"><span><span style="color:#ff7b72;font-weight:bold">[</span>apiclient<span style="color:#ff7b72;font-weight:bold">]</span> Found <span style="color:#a5d6ff">1</span> Pods <span style="color:#ff7b72">for</span> label selector k8s-app<span style="color:#ff7b72;font-weight:bold">=</span>upgrade-prepull-kube-scheduler
</span></span><span style="display:flex;"><span>I1031 16:18:14.046733   <span style="color:#a5d6ff">31033</span> request.go:530<span style="color:#ff7b72;font-weight:bold">]</span> Throttling request took 64.263528ms, request: GET:https://172.27.32.165:6443/api/v1/namespaces/kube-system/pods?labelSelector<span style="color:#ff7b72;font-weight:bold">=</span>k8s-app%3Dupgrade-prepull-kube-controller-manager
</span></span><span style="display:flex;"><span>I1031 16:18:14.246235   <span style="color:#a5d6ff">31033</span> request.go:530<span style="color:#ff7b72;font-weight:bold">]</span> Throttling request took 263.748054ms, request: GET:https://172.27.32.165:6443/api/v1/namespaces/kube-system/pods?labelSelector<span style="color:#ff7b72;font-weight:bold">=</span>k8s-app%3Dupgrade-prepull-kube-scheduler
</span></span><span style="display:flex;"><span>I1031 16:18:14.647280   <span style="color:#a5d6ff">31033</span> request.go:530<span style="color:#ff7b72;font-weight:bold">]</span> Throttling request took 173.534831ms, request: GET:https://172.27.32.165:6443/api/v1/namespaces/kube-system/pods?labelSelector<span style="color:#ff7b72;font-weight:bold">=</span>k8s-app%3Dupgrade-prepull-kube-apiserver
</span></span><span style="display:flex;"><span>I1031 16:18:14.846492   <span style="color:#a5d6ff">31033</span> request.go:530<span style="color:#ff7b72;font-weight:bold">]</span> Throttling request took 367.060734ms, request: GET:https://172.27.32.165:6443/api/v1/namespaces/kube-system/pods?labelSelector<span style="color:#ff7b72;font-weight:bold">=</span>k8s-app%3Dupgrade-prepull-kube-controller-manager
</span></span><span style="display:flex;"><span>I1031 16:18:15.045493   <span style="color:#a5d6ff">31033</span> request.go:530<span style="color:#ff7b72;font-weight:bold">]</span> Throttling request took 566.033546ms, request: GET:https://172.27.32.165:6443/api/v1/namespaces/kube-system/pods?labelSelector<span style="color:#ff7b72;font-weight:bold">=</span>k8s-app%3Dupgrade-prepull-kube-scheduler
</span></span><span style="display:flex;"><span>I1031 16:18:15.245604   <span style="color:#a5d6ff">31033</span> request.go:530<span style="color:#ff7b72;font-weight:bold">]</span> Throttling request took 271.241012ms, request: GET:https://172.27.32.165:6443/api/v1/namespaces/kube-system/pods?labelSelector<span style="color:#ff7b72;font-weight:bold">=</span>k8s-app%3Dupgrade-prepull-etcd
</span></span><span style="display:flex;"><span>I1031 16:18:15.445656   <span style="color:#a5d6ff">31033</span> request.go:530<span style="color:#ff7b72;font-weight:bold">]</span> Throttling request took 471.269391ms, request: GET:https://172.27.32.165:6443/api/v1/namespaces/kube-system/pods?labelSelector<span style="color:#ff7b72;font-weight:bold">=</span>k8s-app%3Dupgrade-prepull-kube-apiserver
</span></span><span style="display:flex;"><span>I1031 16:18:15.646784   <span style="color:#a5d6ff">31033</span> request.go:530<span style="color:#ff7b72;font-weight:bold">]</span> Throttling request took 668.609111ms, request: GET:https://172.27.32.165:6443/api/v1/namespaces/kube-system/pods?labelSelector<span style="color:#ff7b72;font-weight:bold">=</span>k8s-app%3Dupgrade-prepull-kube-controller-manager
</span></span><span style="display:flex;"><span>I1031 16:18:15.845868   <span style="color:#a5d6ff">31033</span> request.go:530<span style="color:#ff7b72;font-weight:bold">]</span> Throttling request took 370.912219ms, request: GET:https://172.27.32.165:6443/api/v1/namespaces/kube-system/pods?labelSelector<span style="color:#ff7b72;font-weight:bold">=</span>k8s-app%3Dupgrade-prepull-etcd
</span></span><span style="display:flex;"><span>I1031 16:18:16.045929   <span style="color:#a5d6ff">31033</span> request.go:530<span style="color:#ff7b72;font-weight:bold">]</span> Throttling request took 570.956625ms, request: GET:https://172.27.32.165:6443/api/v1/namespaces/kube-system/pods?labelSelector<span style="color:#ff7b72;font-weight:bold">=</span>k8s-app%3Dupgrade-prepull-kube-apiserver
</span></span><span style="display:flex;"><span>I1031 16:18:16.245422   <span style="color:#a5d6ff">31033</span> request.go:530<span style="color:#ff7b72;font-weight:bold">]</span> Throttling request took 767.553384ms, request: GET:https://172.27.32.165:6443/api/v1/namespaces/kube-system/pods?labelSelector<span style="color:#ff7b72;font-weight:bold">=</span>k8s-app%3Dupgrade-prepull-kube-scheduler
</span></span><span style="display:flex;"><span>I1031 16:18:16.445445   <span style="color:#a5d6ff">31033</span> request.go:530<span style="color:#ff7b72;font-weight:bold">]</span> Throttling request took 468.71903ms, request: GET:https://172.27.32.165:6443/api/v1/namespaces/kube-system/pods?labelSelector<span style="color:#ff7b72;font-weight:bold">=</span>k8s-app%3Dupgrade-prepull-etcd
</span></span><span style="display:flex;"><span><span style="color:#ff7b72;font-weight:bold">[</span>upgrade/prepull<span style="color:#ff7b72;font-weight:bold">]</span> Prepulled image <span style="color:#ff7b72">for</span> component etcd.
</span></span><span style="display:flex;"><span>I1031 16:18:16.645553   <span style="color:#a5d6ff">31033</span> request.go:530<span style="color:#ff7b72;font-weight:bold">]</span> Throttling request took 666.826898ms, request: GET:https://172.27.32.165:6443/api/v1/namespaces/kube-system/pods?labelSelector<span style="color:#ff7b72;font-weight:bold">=</span>k8s-app%3Dupgrade-prepull-kube-controller-manager
</span></span><span style="display:flex;"><span>I1031 16:18:16.845616   <span style="color:#a5d6ff">31033</span> request.go:530<span style="color:#ff7b72;font-weight:bold">]</span> Throttling request took 371.917463ms, request: GET:https://172.27.32.165:6443/api/v1/namespaces/kube-system/pods?labelSelector<span style="color:#ff7b72;font-weight:bold">=</span>k8s-app%3Dupgrade-prepull-kube-apiserver
</span></span><span style="display:flex;"><span>I1031 16:18:17.047923   <span style="color:#a5d6ff">31033</span> request.go:530<span style="color:#ff7b72;font-weight:bold">]</span> Throttling request took 568.641489ms, request: GET:https://172.27.32.165:6443/api/v1/namespaces/kube-system/pods?labelSelector<span style="color:#ff7b72;font-weight:bold">=</span>k8s-app%3Dupgrade-prepull-kube-scheduler
</span></span><span style="display:flex;"><span>I1031 16:18:17.245839   <span style="color:#a5d6ff">31033</span> request.go:530<span style="color:#ff7b72;font-weight:bold">]</span> Throttling request took 273.128186ms, request: GET:https://172.27.32.165:6443/api/v1/namespaces/kube-system/pods?labelSelector<span style="color:#ff7b72;font-weight:bold">=</span>k8s-app%3Dupgrade-prepull-kube-apiserver
</span></span><span style="display:flex;"><span><span style="color:#ff7b72;font-weight:bold">[</span>upgrade/prepull<span style="color:#ff7b72;font-weight:bold">]</span> Prepulled image <span style="color:#ff7b72">for</span> component kube-apiserver.
</span></span><span style="display:flex;"><span>I1031 16:18:17.445456   <span style="color:#a5d6ff">31033</span> request.go:530<span style="color:#ff7b72;font-weight:bold">]</span> Throttling request took 466.94069ms, request: GET:https://172.27.32.165:6443/api/v1/namespaces/kube-system/pods?labelSelector<span style="color:#ff7b72;font-weight:bold">=</span>k8s-app%3Dupgrade-prepull-kube-controller-manager
</span></span><span style="display:flex;"><span><span style="color:#ff7b72;font-weight:bold">[</span>upgrade/prepull<span style="color:#ff7b72;font-weight:bold">]</span> Prepulled image <span style="color:#ff7b72">for</span> component kube-controller-manager.
</span></span><span style="display:flex;"><span>I1031 16:18:17.646001   <span style="color:#a5d6ff">31033</span> request.go:530<span style="color:#ff7b72;font-weight:bold">]</span> Throttling request took 167.6097ms, request: GET:https://172.27.32.165:6443/api/v1/namespaces/kube-system/pods?labelSelector<span style="color:#ff7b72;font-weight:bold">=</span>k8s-app%3Dupgrade-prepull-kube-scheduler
</span></span><span style="display:flex;"><span><span style="color:#ff7b72;font-weight:bold">[</span>upgrade/prepull<span style="color:#ff7b72;font-weight:bold">]</span> Prepulled image <span style="color:#ff7b72">for</span> component kube-scheduler.
</span></span><span style="display:flex;"><span><span style="color:#ff7b72;font-weight:bold">[</span>upgrade/prepull<span style="color:#ff7b72;font-weight:bold">]</span> Successfully prepulled the images <span style="color:#ff7b72">for</span> all the control plane components
</span></span><span style="display:flex;"><span>I1031 16:18:17.653778   <span style="color:#a5d6ff">31033</span> apply.go:202<span style="color:#ff7b72;font-weight:bold">]</span> <span style="color:#ff7b72;font-weight:bold">[</span>upgrade/apply<span style="color:#ff7b72;font-weight:bold">]</span> performing upgrade
</span></span><span style="display:flex;"><span>I1031 16:18:17.653785   <span style="color:#a5d6ff">31033</span> apply.go:268<span style="color:#ff7b72;font-weight:bold">]</span> checking <span style="color:#ff7b72">if</span> cluster is self-hosted
</span></span><span style="display:flex;"><span><span style="color:#ff7b72;font-weight:bold">[</span>upgrade/apply<span style="color:#ff7b72;font-weight:bold">]</span> Upgrading your Static Pod-hosted control plane to version <span style="color:#a5d6ff">&#34;v1.12.10&#34;</span>...
</span></span><span style="display:flex;"><span>I1031 16:18:17.845963   <span style="color:#a5d6ff">31033</span> request.go:530<span style="color:#ff7b72;font-weight:bold">]</span> Throttling request took 184.620923ms, request: GET:https://172.27.32.165:6443/api/v1/namespaces/kube-system/pods/kube-apiserver-172.27.32.165
</span></span><span style="display:flex;"><span>Static pod: kube-apiserver-172.27.32.165 hash: c5c5b18e12d5e605ef55d516c4559ba0
</span></span><span style="display:flex;"><span>I1031 16:18:18.045736   <span style="color:#a5d6ff">31033</span> request.go:530<span style="color:#ff7b72;font-weight:bold">]</span> Throttling request took 193.159946ms, request: GET:https://172.27.32.165:6443/api/v1/namespaces/kube-system/pods/kube-controller-manager-172.27.32.165
</span></span><span style="display:flex;"><span>Static pod: kube-controller-manager-172.27.32.165 hash: 6e79e209a8bc468fa21969e807be68e3
</span></span><span style="display:flex;"><span>I1031 16:18:18.245404   <span style="color:#a5d6ff">31033</span> request.go:530<span style="color:#ff7b72;font-weight:bold">]</span> Throttling request took 197.471715ms, request: GET:https://172.27.32.165:6443/api/v1/namespaces/kube-system/pods/kube-scheduler-172.27.32.165
</span></span><span style="display:flex;"><span>Static pod: kube-scheduler-172.27.32.165 hash: dcb7e042ad7733f6f04068629eb4b8b9
</span></span><span style="display:flex;"><span><span style="color:#ff7b72;font-weight:bold">[</span>upgrade/staticpods<span style="color:#ff7b72;font-weight:bold">]</span> Writing new Static Pod manifests to <span style="color:#a5d6ff">&#34;/etc/kubernetes/tmp/kubeadm-upgraded-manifests040725233&#34;</span>
</span></span><span style="display:flex;"><span>I1031 16:18:18.247454   <span style="color:#a5d6ff">31033</span> manifests.go:44<span style="color:#ff7b72;font-weight:bold">]</span> <span style="color:#ff7b72;font-weight:bold">[</span>controlplane<span style="color:#ff7b72;font-weight:bold">]</span> creating static pod files
</span></span><span style="display:flex;"><span>I1031 16:18:18.247469   <span style="color:#a5d6ff">31033</span> manifests.go:117<span style="color:#ff7b72;font-weight:bold">]</span> <span style="color:#ff7b72;font-weight:bold">[</span>controlplane<span style="color:#ff7b72;font-weight:bold">]</span> getting StaticPodSpecs
</span></span><span style="display:flex;"><span><span style="color:#ff7b72;font-weight:bold">[</span>controlplane<span style="color:#ff7b72;font-weight:bold">]</span> wrote Static Pod manifest <span style="color:#ff7b72">for</span> component kube-apiserver to <span style="color:#a5d6ff">&#34;/etc/kubernetes/tmp/kubeadm-upgraded-manifests040725233/kube-apiserver.yaml&#34;</span>
</span></span><span style="display:flex;"><span><span style="color:#ff7b72;font-weight:bold">[</span>controlplane<span style="color:#ff7b72;font-weight:bold">]</span> wrote Static Pod manifest <span style="color:#ff7b72">for</span> component kube-controller-manager to <span style="color:#a5d6ff">&#34;/etc/kubernetes/tmp/kubeadm-upgraded-manifests040725233/kube-controller-manager.yaml&#34;</span>
</span></span><span style="display:flex;"><span><span style="color:#ff7b72;font-weight:bold">[</span>controlplane<span style="color:#ff7b72;font-weight:bold">]</span> wrote Static Pod manifest <span style="color:#ff7b72">for</span> component kube-scheduler to <span style="color:#a5d6ff">&#34;/etc/kubernetes/tmp/kubeadm-upgraded-manifests040725233/kube-scheduler.yaml&#34;</span>
</span></span><span style="display:flex;"><span><span style="color:#ff7b72;font-weight:bold">[</span>upgrade/staticpods<span style="color:#ff7b72;font-weight:bold">]</span> Moved new manifest to <span style="color:#a5d6ff">&#34;/etc/kubernetes/manifests/kube-apiserver.yaml&#34;</span> and backed up old manifest to <span style="color:#a5d6ff">&#34;/etc/kubernetes/tmp/kubeadm-backup-manifests-2019-10-31-16-18-17/kube-apiserver.yaml&#34;</span>
</span></span><span style="display:flex;"><span><span style="color:#ff7b72;font-weight:bold">[</span>upgrade/staticpods<span style="color:#ff7b72;font-weight:bold">]</span> Waiting <span style="color:#ff7b72">for</span> the kubelet to restart the component
</span></span><span style="display:flex;"><span><span style="color:#ff7b72;font-weight:bold">[</span>upgrade/staticpods<span style="color:#ff7b72;font-weight:bold">]</span> This might take a minute or longer depending on the component/version gap <span style="color:#ff7b72;font-weight:bold">(</span>timeout 5m0s
</span></span><span style="display:flex;"><span>I1031 16:18:18.446010   <span style="color:#a5d6ff">31033</span> request.go:530<span style="color:#ff7b72;font-weight:bold">]</span> Throttling request took 178.44808ms, request: GET:https://172.27.32.165:6443/api/v1/namespaces/kube-system/pods/kube-apiserver-172.27.32.165
</span></span><span style="display:flex;"><span>Static pod: kube-apiserver-172.27.32.165 hash: 7d9abb385d9679f7575617a4e03828be
</span></span><span style="display:flex;"><span>I1031 16:18:18.648914   <span style="color:#a5d6ff">31033</span> request.go:530<span style="color:#ff7b72;font-weight:bold">]</span> Throttling request took 200.383408ms, request: GET:https://172.27.32.165:6443/api/v1/namespaces/kube-system/pods?labelSelector<span style="color:#ff7b72;font-weight:bold">=</span>component%3Dkube-apiserver
</span></span><span style="display:flex;"><span><span style="color:#ff7b72;font-weight:bold">[</span>apiclient<span style="color:#ff7b72;font-weight:bold">]</span> Error getting Pods with label selector <span style="color:#a5d6ff">&#34;component=kube-apiserver&#34;</span> <span style="color:#ff7b72;font-weight:bold">[</span>Get https://172.27.32.165:6443/api/v1/namespaces/kube-system/pods?labelSelector<span style="color:#ff7b72;font-weight:bold">=</span>component%3Dkube-apiserver: dial tcp 172.27.32.165:6443: connect: connection refused<span style="color:#ff7b72;font-weight:bold">]</span>
</span></span><span style="display:flex;"><span><span style="color:#ff7b72;font-weight:bold">[</span>apiclient<span style="color:#ff7b72;font-weight:bold">]</span> Error getting Pods with label selector <span style="color:#a5d6ff">&#34;component=kube-apiserver&#34;</span> <span style="color:#ff7b72;font-weight:bold">[</span>Get https://172.27.32.165:6443/api/v1/namespaces/kube-system/pods?labelSelector<span style="color:#ff7b72;font-weight:bold">=</span>component%3Dkube-apiserver: dial tcp 172.27.32.165:6443: connect: connection refused<span style="color:#ff7b72;font-weight:bold">]</span>
</span></span><span style="display:flex;"><span><span style="color:#ff7b72;font-weight:bold">[</span>apiclient<span style="color:#ff7b72;font-weight:bold">]</span> Error getting Pods with label selector <span style="color:#a5d6ff">&#34;component=kube-apiserver&#34;</span> <span style="color:#ff7b72;font-weight:bold">[</span>Get https://172.27.32.165:6443/api/v1/namespaces/kube-system/pods?labelSelector<span style="color:#ff7b72;font-weight:bold">=</span>component%3Dkube-apiserver: dial tcp 172.27.32.165:6443: connect: connection refused<span style="color:#ff7b72;font-weight:bold">]</span>
</span></span><span style="display:flex;"><span><span style="color:#ff7b72;font-weight:bold">[</span>apiclient<span style="color:#ff7b72;font-weight:bold">]</span> Error getting Pods with label selector <span style="color:#a5d6ff">&#34;component=kube-apiserver&#34;</span> <span style="color:#ff7b72;font-weight:bold">[</span>Get https://172.27.32.165:6443/api/v1/namespaces/kube-system/pods?labelSelector<span style="color:#ff7b72;font-weight:bold">=</span>component%3Dkube-apiserver: dial tcp 172.27.32.165:6443: connect: connection refused<span style="color:#ff7b72;font-weight:bold">]</span>
</span></span><span style="display:flex;"><span><span style="color:#ff7b72;font-weight:bold">[</span>apiclient<span style="color:#ff7b72;font-weight:bold">]</span> Error getting Pods with label selector <span style="color:#a5d6ff">&#34;component=kube-apiserver&#34;</span> <span style="color:#ff7b72;font-weight:bold">[</span>Get https://172.27.32.165:6443/api/v1/namespaces/kube-system/pods?labelSelector<span style="color:#ff7b72;font-weight:bold">=</span>component%3Dkube-apiserver: dial tcp 172.27.32.165:6443: connect: connection refused<span style="color:#ff7b72;font-weight:bold">]</span>
</span></span><span style="display:flex;"><span><span style="color:#ff7b72;font-weight:bold">[</span>apiclient<span style="color:#ff7b72;font-weight:bold">]</span> Error getting Pods with label selector <span style="color:#a5d6ff">&#34;component=kube-apiserver&#34;</span> <span style="color:#ff7b72;font-weight:bold">[</span>Get https://172.27.32.165:6443/api/v1/namespaces/kube-system/pods?labelSelector<span style="color:#ff7b72;font-weight:bold">=</span>component%3Dkube-apiserver: net/http: TLS handshake timeout<span style="color:#ff7b72;font-weight:bold">]</span>
</span></span><span style="display:flex;"><span><span style="color:#ff7b72;font-weight:bold">[</span>apiclient<span style="color:#ff7b72;font-weight:bold">]</span> Found <span style="color:#a5d6ff">1</span> Pods <span style="color:#ff7b72">for</span> label selector <span style="color:#79c0ff">component</span><span style="color:#ff7b72;font-weight:bold">=</span>kube-apiserver
</span></span><span style="display:flex;"><span><span style="color:#ff7b72;font-weight:bold">[</span>upgrade/staticpods<span style="color:#ff7b72;font-weight:bold">]</span> Component <span style="color:#a5d6ff">&#34;kube-apiserver&#34;</span> upgraded successfully!
</span></span><span style="display:flex;"><span><span style="color:#ff7b72;font-weight:bold">[</span>upgrade/staticpods<span style="color:#ff7b72;font-weight:bold">]</span> Moved new manifest to <span style="color:#a5d6ff">&#34;/etc/kubernetes/manifests/kube-controller-manager.yaml&#34;</span> and backed up old manifest to <span style="color:#a5d6ff">&#34;/etc/kubernetes/tmp/kubeadm-backup-manifests-2019-10-31-16-18-17/kube-controller-manager.yaml&#34;</span>
</span></span><span style="display:flex;"><span><span style="color:#ff7b72;font-weight:bold">[</span>upgrade/staticpods<span style="color:#ff7b72;font-weight:bold">]</span> Waiting <span style="color:#ff7b72">for</span> the kubelet to restart the component
</span></span><span style="display:flex;"><span><span style="color:#ff7b72;font-weight:bold">[</span>upgrade/staticpods<span style="color:#ff7b72;font-weight:bold">]</span> This might take a minute or longer depending on the component/version gap <span style="color:#ff7b72;font-weight:bold">(</span>timeout 5m0s
</span></span><span style="display:flex;"><span>Static pod: kube-controller-manager-172.27.32.165 hash: 6e79e209a8bc468fa21969e807be68e3
</span></span><span style="display:flex;"><span>Static pod: kube-controller-manager-172.27.32.165 hash: a9ef5d96e631ef6bb37aa7399b39ce31
</span></span><span style="display:flex;"><span><span style="color:#ff7b72;font-weight:bold">[</span>apiclient<span style="color:#ff7b72;font-weight:bold">]</span> Found <span style="color:#a5d6ff">1</span> Pods <span style="color:#ff7b72">for</span> label selector <span style="color:#79c0ff">component</span><span style="color:#ff7b72;font-weight:bold">=</span>kube-controller-manager
</span></span><span style="display:flex;"><span><span style="color:#ff7b72;font-weight:bold">[</span>upgrade/staticpods<span style="color:#ff7b72;font-weight:bold">]</span> Component <span style="color:#a5d6ff">&#34;kube-controller-manager&#34;</span> upgraded successfully!
</span></span><span style="display:flex;"><span><span style="color:#ff7b72;font-weight:bold">[</span>upgrade/staticpods<span style="color:#ff7b72;font-weight:bold">]</span> Moved new manifest to <span style="color:#a5d6ff">&#34;/etc/kubernetes/manifests/kube-scheduler.yaml&#34;</span> and backed up old manifest to <span style="color:#a5d6ff">&#34;/etc/kubernetes/tmp/kubeadm-backup-manifests-2019-10-31-16-18-17/kube-scheduler.yaml&#34;</span>
</span></span><span style="display:flex;"><span><span style="color:#ff7b72;font-weight:bold">[</span>upgrade/staticpods<span style="color:#ff7b72;font-weight:bold">]</span> Waiting <span style="color:#ff7b72">for</span> the kubelet to restart the component
</span></span><span style="display:flex;"><span><span style="color:#ff7b72;font-weight:bold">[</span>upgrade/staticpods<span style="color:#ff7b72;font-weight:bold">]</span> This might take a minute or longer depending on the component/version gap <span style="color:#ff7b72;font-weight:bold">(</span>timeout 5m0s
</span></span><span style="display:flex;"><span>Static pod: kube-scheduler-172.27.32.165 hash: dcb7e042ad7733f6f04068629eb4b8b9
</span></span><span style="display:flex;"><span>Static pod: kube-scheduler-172.27.32.165 hash: 92d30ca7866fe98c3147c1f8f4c3d413
</span></span><span style="display:flex;"><span><span style="color:#ff7b72;font-weight:bold">[</span>apiclient<span style="color:#ff7b72;font-weight:bold">]</span> Found <span style="color:#a5d6ff">1</span> Pods <span style="color:#ff7b72">for</span> label selector <span style="color:#79c0ff">component</span><span style="color:#ff7b72;font-weight:bold">=</span>kube-scheduler
</span></span><span style="display:flex;"><span><span style="color:#ff7b72;font-weight:bold">[</span>upgrade/staticpods<span style="color:#ff7b72;font-weight:bold">]</span> Component <span style="color:#a5d6ff">&#34;kube-scheduler&#34;</span> upgraded successfully!
</span></span><span style="display:flex;"><span>I1031 16:18:47.231899   <span style="color:#a5d6ff">31033</span> apply.go:208<span style="color:#ff7b72;font-weight:bold">]</span> <span style="color:#ff7b72;font-weight:bold">[</span>upgrade/postupgrade<span style="color:#ff7b72;font-weight:bold">]</span> upgrading RBAC rules and addons
</span></span><span style="display:flex;"><span><span style="color:#ff7b72;font-weight:bold">[</span>uploadconfig<span style="color:#ff7b72;font-weight:bold">]</span> storing the configuration used in ConfigMap <span style="color:#a5d6ff">&#34;kubeadm-config&#34;</span> in the <span style="color:#a5d6ff">&#34;kube-system&#34;</span> Namespace
</span></span><span style="display:flex;"><span><span style="color:#ff7b72;font-weight:bold">[</span>kubelet<span style="color:#ff7b72;font-weight:bold">]</span> Creating a ConfigMap <span style="color:#a5d6ff">&#34;kubelet-config-1.12&#34;</span> in namespace kube-system with the configuration <span style="color:#ff7b72">for</span> the kubelets in the cluster
</span></span><span style="display:flex;"><span><span style="color:#ff7b72;font-weight:bold">[</span>kubelet<span style="color:#ff7b72;font-weight:bold">]</span> Downloading configuration <span style="color:#ff7b72">for</span> the kubelet from the <span style="color:#a5d6ff">&#34;kubelet-config-1.12&#34;</span> ConfigMap in the kube-system namespace
</span></span><span style="display:flex;"><span><span style="color:#ff7b72;font-weight:bold">[</span>kubelet<span style="color:#ff7b72;font-weight:bold">]</span> Writing kubelet configuration to file <span style="color:#a5d6ff">&#34;/var/lib/kubelet/config.yaml&#34;</span>
</span></span><span style="display:flex;"><span><span style="color:#ff7b72;font-weight:bold">[</span>patchnode<span style="color:#ff7b72;font-weight:bold">]</span> Uploading the CRI Socket information <span style="color:#a5d6ff">&#34;/var/run/dockershim.sock&#34;</span> to the Node API object <span style="color:#a5d6ff">&#34;172.27.32.165&#34;</span> as an annotation
</span></span><span style="display:flex;"><span><span style="color:#ff7b72;font-weight:bold">[</span>bootstraptoken<span style="color:#ff7b72;font-weight:bold">]</span> configured RBAC rules to allow Node Bootstrap tokens to post CSRs in order <span style="color:#ff7b72">for</span> nodes to get long term certificate credentials
</span></span><span style="display:flex;"><span><span style="color:#ff7b72;font-weight:bold">[</span>bootstraptoken<span style="color:#ff7b72;font-weight:bold">]</span> configured RBAC rules to allow the csrapprover controller automatically approve CSRs from a Node Bootstrap Token
</span></span><span style="display:flex;"><span><span style="color:#ff7b72;font-weight:bold">[</span>bootstraptoken<span style="color:#ff7b72;font-weight:bold">]</span> configured RBAC rules to allow certificate rotation <span style="color:#ff7b72">for</span> all node client certificates in the cluster
</span></span><span style="display:flex;"><span>I1031 16:18:47.794738   <span style="color:#a5d6ff">31033</span> clusterinfo.go:79<span style="color:#ff7b72;font-weight:bold">]</span> creating the RBAC rules <span style="color:#ff7b72">for</span> exposing the cluster-info ConfigMap in the kube-public namespace
</span></span><span style="display:flex;"><span>I1031 16:18:47.849852   <span style="color:#a5d6ff">31033</span> request.go:530<span style="color:#ff7b72;font-weight:bold">]</span> Throttling request took 50.242056ms, request: POST:https://172.27.32.165:6443/apis/rbac.authorization.k8s.io/v1/namespaces/kube-public/rolebindings
</span></span><span style="display:flex;"><span>I1031 16:18:48.049867   <span style="color:#a5d6ff">31033</span> request.go:530<span style="color:#ff7b72;font-weight:bold">]</span> Throttling request took 195.937473ms, request: PUT:https://172.27.32.165:6443/apis/rbac.authorization.k8s.io/v1/namespaces/kube-public/rolebindings/kubeadm:bootstrap-signer-clusterinfo
</span></span><span style="display:flex;"><span>I1031 16:18:48.249312   <span style="color:#a5d6ff">31033</span> request.go:530<span style="color:#ff7b72;font-weight:bold">]</span> Throttling request took 189.877158ms, request: POST:https://172.27.32.165:6443/apis/rbac.authorization.k8s.io/v1/clusterroles
</span></span><span style="display:flex;"><span>I1031 16:18:48.449307   <span style="color:#a5d6ff">31033</span> request.go:530<span style="color:#ff7b72;font-weight:bold">]</span> Throttling request took 195.86853ms, request: PUT:https://172.27.32.165:6443/apis/rbac.authorization.k8s.io/v1/clusterroles/system:coredns
</span></span><span style="display:flex;"><span>I1031 16:18:48.650121   <span style="color:#a5d6ff">31033</span> request.go:530<span style="color:#ff7b72;font-weight:bold">]</span> Throttling request took 198.286357ms, request: POST:https://172.27.32.165:6443/apis/rbac.authorization.k8s.io/v1/clusterrolebindings
</span></span><span style="display:flex;"><span>I1031 16:18:48.849300   <span style="color:#a5d6ff">31033</span> request.go:530<span style="color:#ff7b72;font-weight:bold">]</span> Throttling request took 196.19422ms, request: PUT:https://172.27.32.165:6443/apis/rbac.authorization.k8s.io/v1/clusterrolebindings/system:coredns
</span></span><span style="display:flex;"><span><span style="color:#ff7b72;font-weight:bold">[</span>addons<span style="color:#ff7b72;font-weight:bold">]</span> Applied essential addon: CoreDNS
</span></span><span style="display:flex;"><span>I1031 16:18:49.049271   <span style="color:#a5d6ff">31033</span> request.go:530<span style="color:#ff7b72;font-weight:bold">]</span> Throttling request took 146.459988ms, request: POST:https://172.27.32.165:6443/apis/rbac.authorization.k8s.io/v1/clusterrolebindings
</span></span><span style="display:flex;"><span>I1031 16:18:49.249379   <span style="color:#a5d6ff">31033</span> request.go:530<span style="color:#ff7b72;font-weight:bold">]</span> Throttling request took 195.347278ms, request: PUT:https://172.27.32.165:6443/apis/rbac.authorization.k8s.io/v1/clusterrolebindings/kubeadm:node-proxier
</span></span><span style="display:flex;"><span>I1031 16:18:49.449396   <span style="color:#a5d6ff">31033</span> request.go:530<span style="color:#ff7b72;font-weight:bold">]</span> Throttling request took 198.120697ms, request: POST:https://172.27.32.165:6443/apis/rbac.authorization.k8s.io/v1/namespaces/kube-system/roles
</span></span><span style="display:flex;"><span>I1031 16:18:49.649555   <span style="color:#a5d6ff">31033</span> request.go:530<span style="color:#ff7b72;font-weight:bold">]</span> Throttling request took 197.170914ms, request: POST:https://172.27.32.165:6443/apis/rbac.authorization.k8s.io/v1/namespaces/kube-system/rolebindings
</span></span><span style="display:flex;"><span><span style="color:#ff7b72;font-weight:bold">[</span>addons<span style="color:#ff7b72;font-weight:bold">]</span> Applied essential addon: kube-proxy
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span><span style="color:#ff7b72;font-weight:bold">[</span>upgrade/successful<span style="color:#ff7b72;font-weight:bold">]</span> SUCCESS! Your cluster was upgraded to <span style="color:#a5d6ff">&#34;v1.12.10&#34;</span>. Enjoy!
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span><span style="color:#ff7b72;font-weight:bold">[</span>upgrade/kubelet<span style="color:#ff7b72;font-weight:bold">]</span> Now that your control plane is upgraded, please proceed with upgrading your kubelets <span style="color:#ff7b72">if</span> you haven<span style="color:#f85149">&#39;</span>t already <span style="color:#ff7b72">done</span> so.
</span></span></code></pre></div><p>升级成功后升级 kubectl：</p>
<div class="highlight"><pre tabindex="0" style="color:#e6edf3;background-color:#0d1117;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-shell" data-lang="shell"><span style="display:flex;"><span><span style="color:#8b949e;font-style:italic"># upgrade kubectl</span>
</span></span><span style="display:flex;"><span>yum upgrade -y  kubectl-1.12.10 --disableexcludes<span style="color:#ff7b72;font-weight:bold">=</span>kubernetes
</span></span></code></pre></div><h2 id="升级-kubelet">
  升级 kubelet
  <a class="heading-link" href="#%e5%8d%87%e7%ba%a7-kubelet">
    <i class="fa-solid fa-link" aria-hidden="true" title="Link to heading"></i>
    <span class="sr-only">Link to heading</span>
  </a>
</h2>
<p>逐台节点升级 kubelet。 <br>
升级前最好先备份下当前kubelet的配置：</p>
<div class="highlight"><pre tabindex="0" style="color:#e6edf3;background-color:#0d1117;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-shell" data-lang="shell"><span style="display:flex;"><span>cp /usr/lib/systemd/system/kubelet.service.d/10-kubeadm.conf 10-kubeadm.conf.bak
</span></span></code></pre></div><div class="highlight"><pre tabindex="0" style="color:#e6edf3;background-color:#0d1117;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-shell" data-lang="shell"><span style="display:flex;"><span><span style="color:#8b949e;font-style:italic"># upgrade kubelet/kubeadm</span>
</span></span><span style="display:flex;"><span>yum upgrade -y  kubelet-1.12.10 kubeadm-1.12.10 --disableexcludes<span style="color:#ff7b72;font-weight:bold">=</span>kubernetes
</span></span><span style="display:flex;"><span><span style="color:#8b949e;font-style:italic"># kubeadm upgrade node config</span>
</span></span><span style="display:flex;"><span>kubeadm upgrade node config --kubelet-version <span style="color:#ff7b72">$(</span>kubelet --version | cut -d <span style="color:#a5d6ff">&#39; &#39;</span> -f 2<span style="color:#ff7b72">)</span><span style="color:#f85149">&#39;</span>
</span></span><span style="display:flex;"><span><span style="color:#8b949e;font-style:italic"># restart</span>
</span></span><span style="display:flex;"><span>systemctl daemon-reload
</span></span><span style="display:flex;"><span>systemctl restart kubelet
</span></span></code></pre></div><p>至此升级完成，可以执行<code>kubectl get nodes</code>，进行验证，是否所有 node 都正常启动。</p>
      </div>


      <footer>
        


        <div id="disqus_thread"></div>
<script>
  window.disqus_config = function () {
    
    
    
    };
    (function() {
        if (["localhost", "127.0.0.1"].indexOf(window.location.hostname) != -1) {
            document.getElementById('disqus_thread').innerHTML = 'Disqus comments not available by default when the website is previewed locally.';
            return;
        }
        var d = document, s = d.createElement('script'); s.async = true;
        s.src = '//' + "maoqide-1" + '.disqus.com/embed.js';
        s.setAttribute('data-timestamp', +new Date());
        (d.head || d.body).appendChild(s);
    })();
    
    document.addEventListener('themeChanged', function (e) { 
        if (document.readyState == 'complete') {
          DISQUS.reset({ reload: true, config: disqus_config });
        }
    });
</script>
        
        
        
        

        
      </footer>
    </article>

    
  </section>

    </div>

    <footer class="footer">
  <section class="container">
    @
    
      2018 -
    
    2025
     Maoqide 
    ·
    
     <a href="https://gohugo.io/" target="_blank" rel="noopener">Hugo</a> & <a href="https://github.com/luizdepra/hugo-coder/" target="_blank" rel="noopener">Coder</a>.
    
    
      <p><a href="https://beian.miit.gov.cn/" target="_blank" title="Check ICP info" rel="noopener">浙ICP备19006182号</a></p>
    
  </section>
</footer>

  </main>

  

  
  
  <script src="/js/coder.min.6ae284be93d2d19dad1f02b0039508d9aab3180a12a06dcc71b0b0ef7825a317.js" integrity="sha256-auKEvpPS0Z2tHwKwA5UI2aqzGAoSoG3McbCw73gloxc="></script>
  

  

  


  
<script async src="https://www.googletagmanager.com/gtag/js?id=G-MHZR8L7VXH"></script>
<script>
var doNotTrack = false;
if (!doNotTrack) {
	window.dataLayer = window.dataLayer || [];
	function gtag(){dataLayer.push(arguments);}
	gtag('js', new Date());
	gtag('config', 'G-MHZR8L7VXH', { 'anonymize_ip': false });
}
</script>


  

  

  

  

  
<script>
var _hmt = _hmt || [];
(function() {
    var hm = document.createElement("script");
    hm.src = "https://hm.baidu.com/hm.js?c3c6dd2eb79bc741d95463b6040ac868";
    var s = document.getElementsByTagName("script")[0]; 
    s.parentNode.insertBefore(hm, s);
})();
</script>



  

  

  

  

  

  

  

  

  
</body>

</html>
